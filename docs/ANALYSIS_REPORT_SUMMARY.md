# 인플레이션 환경에서 디저트 소비 선호도 변화 분석 및 머신러닝 예측

## 분석 결과 보고서 요약

> **관련 문서**: [MODEL_DESIGN_SPEC.md](MODEL_DESIGN_SPEC.md) — 최종 Feature List, 실험표, 해석 템플릿

---

## 1. 연구 개요

### 1.1 목적

인플레이션(물가 상승) 환경에서 서울시 행정동 단위 **디저트(카페·제과점)** 소비 선호도의 변화를 분석하고, 머신러닝 기반 예측 모델을 비교·평가한다.

### 1.2 분석 대상

| 항목 | 내용 |
|------|------|
| 데이터 | 서울시 상권분석 서비스 (추정매출-행정동) 5개년 (2020~2024) |
| 업종 | 제과점, 커피-음료 (디저트) |
| 단위 | 행정동 × 연도 × 분기 |
| 행정동 수 | 420개 |
| 총 관측치 | 약 8,366행 |

---

## 2. 전처리 요약

### 2.1 비율화

**디저트 비중** = (카페+제과점 매출) / 전체 상권 매출

- 규모 차이 보정, 0~1 범위 선호도 지표로 사용

### 2.2 로그 변환

**log_당월_매출_금액** = log(매출 + 1)

- 분산 안정화, 우측 치우침 완화

### 2.3 시계열 파생변수

| 변수 | 설명 |
|------|------|
| lag1 | 전분기 매출 |
| lag4 | 전년 동분기 매출 (계절성) |
| lag1_비중, lag4_비중 | 전분기·전년 동분기 디저트 비중 |
| 성장률 | (이번분기−전분기)/전분기 |

### 2.4 계절성

- **month_sin**, **month_cos**: sin(2π×월/12), cos(2π×월/12)

### 2.5 인플레이션 변수 (CPI)

- **소비자물가지수(CPI)**, **월별 등락률(inflation_mom)**, **기대인플레이션율**
- 월별 → 분기 평균으로 변환 후 `(연도, 분기)` 기준 병합
- **물가상승률** = CPI_qoq (분기 대비)
- **물가_x_lag1비중** = 상호작용항

### 2.6 타겟

- **다음 분기 디저트 비중** (shift=-1)
- 현재 분기 비중은 피처에서 제외 (데이터 유출 방지)

### 2.7 이상치 및 Train/Test 분리

- IQR 클리핑: 성장률, 디저트_비중
- **Train**: 연도 &lt; 2024 (약 6,686행)
- **Test**: 연도 ≥ 2024 (약 1,680행)

---

## 3. 디저트·소비자물가 상관분석

분기별 총 디저트 매출·평균 비중과 소비자물가 변수 간 상관계수:

| 디저트 변수 | CPI | inflation_mom | expected_inflation | CPI_qoq | CPI_yoy |
|-------------|-----|---------------|---------------------|---------|---------|
| 총_디저트_매출 | **0.82** | 0.21 | **0.80** | 0.35 | **0.76** |
| 평균_디저트_매출 | **0.82** | 0.21 | **0.80** | 0.34 | **0.75** |
| 평균_디저트_비중 | 0.50 | 0.38 | 0.48 | 0.47 | **0.66** |

**해석**

- CPI·기대인플레이션 상승 시 디저트 매출도 증가 추세 (양의 상관)
- 시계열 공동 추세(시간 경과에 따른 성장) 반영 가능성
- 디저트 비중은 CPI_yoy와 상대적으로 높은 상관 (0.66)

---

## 4. 다중공선성 (VIF)

| 피처 | VIF |
|------|-----|
| lag1_비중 | 36.99 |
| lag1 | 34.37 |
| lag4 | 33.70 |
| 물가상승률 | 21.00 |
| 물가_x_lag1비중 | 20.92 |
| lag4_비중 | 20.66 |
| 성장률 | 1.22 |
| month_cos | 1.18 |
| month_sin | 1.00 |
| log_당월_매출_금액 | 0.08 |

- **VIF &gt; 10** 변수: lag1_비중, lag1, lag4, 물가상승률, 물가_x_lag1비중, lag4_비중
- PCA 또는 일부 변수 제거를 통한 추가 실험 권장

---

## 5. 모델 성능 비교

| 모델 | RMSE | MAE | R² |
|------|------|-----|-----|
| Linear Regression | 0.0198 | 0.0054 | **0.8578** |
| Decision Tree | 0.0245 | 0.0066 | 0.7811 |
| Random Forest | 0.0245 | 0.0061 | 0.7820 |
| MLP | 0.0307 | 0.0221 | 0.6567 |

- **Linear Regression**이 가장 높은 R² (0.86) 기록
- Random Forest·Decision Tree: 0.78 수준
- MLP: 스케일링·구조 튜닝 여지 있음

---

## 6. Feature Importance (RF 기준)

| 피처 | RF | DT |
|------|-----|-----|
| lag1_비중 | **82.4%** | **91.6%** |
| lag4_비중 | **12.8%** | 4.3% |
| 성장률 | 1.8% | 1.4% |
| lag4 | 0.9% | 0.9% |
| log_당월_매출_금액 | 0.7% | 0.9% |
| 물가_x_lag1비중 | 0.5% | 0.3% |
| lag1 | 0.5% | 0.3% |
| month_sin | 0.3% | 0.2% |
| month_cos | 0.1% | 0.1% |
| 물가상승률 | 0.1% | &lt;0.1% |

**해석**

- **lag1_비중**(전분기 디저트 비중)이 다음 분기 예측에 가장 중요
- 디저트 비중은 시계열적 자기상관이 크다는 의미
- 물가 관련 변수(물가상승률, 물가_x_lag1비중)는 상대적으로 기여도 낮음

---

## 7. 군집 분석 (k-means)

- 행정동별: 매출 mean/std, 성장률 mean, 디저트_비중 mean로 군집화
- 3개 군집: 고소비 안정형, 저소비 변동형, 성장형
- 군집별 디저트 비중 추이 시각화: `outputs/figures/ml/kmeans_cluster_trend.png`

---

## 8. 시각화 결과물

| 구분 | 파일 | 내용 |
|------|------|------|
| 기본 | outputs/figures/basic/ | 매출 추이, 상위 행정동, 성별 비교 |
| 전처리 | outputs/figures/preprocess/ | 비중·로그·lag·성장률·계절성·상관행렬 |
| 인플레이션 | outputs/figures/inflation/ | CPI·CPI_qoq/yoy·기대인플레이션 추이 |
| 상관분석 | outputs/figures/correlation/ | 디저트-물가 상관 히트맵·산점도·시계열 |
| ML | outputs/figures/ml/ | k-means 군집별 디저트 비중 추이 |

---

## 9. 결론 및 한계

### 9.1 결론

1. **디저트 비중**은 전분기·전년 동분기 비중(lag1_비중, lag4_비중)과 강한 자기상관을 보인다.
2. **CPI·기대인플레이션**과 디저트 매출·비중은 양의 상관을 보이나, 직접적인 예측 변수로서의 기여는 제한적이다.
3. **Linear Regression**이 본 데이터에서 가장 좋은 성능(R²≈0.86)을 보였다.

### 9.2 한계

- lag 변수 간 다중공선성(VIF&gt;10) 존재
- 코로나 영향 구간(2020~2021) 등 특수 시기 반영 미흡
- 외식업 전체 대비 디저트 비중만 사용, 개별 물가지수(외식·가공식품 등) 미활용

### 9.3 모델 보완 실험 (6종)

#### (1) VIF 처리 3트랙

| 실험 | RMSE | R² | 비고 |
|------|------|-----|------|
| Track A: lag1_비중만 (lag4_비중 제거) | 0.0188 | 0.872 | 변수선택 |
| Track B: PCA 2 comp (고VIF 축소) | 0.0499 | 0.095 | 정보 손실 큼 |
| Track C: Ridge | 0.0187 | **0.872** | L2 정규화로 공선성 완화 |
| Track C: Lasso | 0.0200 | 0.855 | 변수 소거 효과 |
| Track C: ElasticNet | 0.0198 | 0.858 | L1+L2 |

**해석**: Ridge가 LR과 유사한 성능을 유지하면서 다중공선성에 강함. PCA는 예측력 급락.

#### (2) 2단계 모델 (부분회귀)

- **1단계**: lag-only 모델로 예측 → 잔차 산출
- **2단계**: 잔차를 물가/기대인플레로 회귀

| 단계 | R² |
|------|-----|
| Stage 1 (lag-only) | 0.858 |
| Stage 2 (잔차→물가) | -0.004 |

**해석**: lag 제거 후에도 물가가 잔차를 유의미하게 설명하지 못함. "물가가 묻힌다"는 직관을 정량적으로 뒷받침.

#### (3) TimeSeriesSplit 롤링 검증

| Train | Test | RMSE | MAE | R² |
|-------|------|------|-----|-----|
| 2020~2021 | 2022 | 0.0135 | 0.0066 | 0.886 |
| 2020~2022 | 2023 | 0.0097 | 0.0049 | 0.942 |
| 2020~2023 | 2024 | 0.0198 | 0.0054 | 0.858 |
| **평균 ± 표준편차** | | **0.0143 ± 0.0051** | **0.0056 ± 0.0008** | **0.896 ± 0.043** |

**해석**: 단일 2024 holdout만이 아닌 롤링 검증으로 일반화 성능 확인. 운에 의한 결과 아님.

#### (4) 군집별 모델 (물가 계수)

| 군집 | n_train | n_test | R² | 물가_계수 |
|------|---------|--------|-----|-----------|
| 0 | 1,304 | 327 | 0.777 | -0.18 |
| 1 | 3,558 | 897 | 0.833 | -0.10 |
| 2 | 144 | 36 | 0.904 | **-0.45** |

**해석**: 군집 2(소규모)가 물가 민감도(음수 계수)가 큼. 세그먼트별 정책·마케팅 차별화 근거.

#### (5) MLP 개선

- EarlyStopping, L2(alpha=0.001), validation_fraction=0.1
- R² 0.66 → 0.80 수준으로 개선 (기존 0.66 대비)
- 데이터 분기 20개 수준이라 딥러닝 불리 → 발표 포인트로 활용 가능

#### (6) 물가 상호작용 재설계

| 상호작용 | RMSE | R² |
|----------|------|-----|
| 기존: 물가_x_lag1비중 | 0.0198 | 0.858 |
| 물가_x_성장률 | 0.0198 | 0.858 |
| 물가_x_비중변화 | 0.0198 | 0.858 |

**해석**: 상호작용 형태 변경이 성능에 큰 차이를 주지 않음. 물가 효과가 약하다는 점 재확인.

---

### 9.5 변화량 타겟 + 물가 충격 + 행정동 FE 파이프라인

**변경 사항**

1. **타겟**: `target_delta_ratio` = 다음 분기 비중 − 이번 분기 비중 (관성 제거)
2. **물가 충격 변수**: `infl_shock_ma` (현재 − 최근 1년 평균), `infl_shock_ma_lag1`, `exp_shock_ma` 등
3. **행정동 고정효과**: 상권 성격(α_i) 통제

**실행**: `python scripts/run_fe_pipeline.py`

**Baseline vs Full (2024 holdout)**

| 모델 | RMSE | R² |
|------|------|-----|
| Baseline (lag-only) | 0.00496 | 0.071 |
| Full (lag+shock) | 0.00494 | **0.079** |
| Full FE (행정동 FE) | 0.00512 | 0.009 |

**FE 계수 (물가 충격 유의)**

| 변수 | 계수 | p-value | 유의성 |
|------|------|---------|--------|
| infl_shock_ma | -0.115 | 0.002 | *** |
| infl_shock_ma_lag1 | 0.101 | 0.006 | ** |
| lag4_비중 | -0.043 | 0.005 | ** |
| 성장률 | -0.006 | <0.001 | *** |

**해석**: 물가 서프라이즈(infl_shock_ma) 상승 시 비중 변화량 감소(음수 계수). “물가 충격이 예측에 기여”하는 근거.

---

### 9.6 향후 과제

- 개별 물가지수(외식·가공식품 등) 활용
